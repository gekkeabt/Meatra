<!DOCTYPE html>
<html>
<head>
	<title>Movie Download</title>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/style.css">
	<link rel="stylesheet" type="text/css" href="css/animate.css">
</head>
<body>


<!-- START FIXED NAVBAR -->
<div id="wrapper">
	<div id="sidebar-wrapper"> 
		<ul class="sidebar-nav genres-menu">
		<b class="sidebar-brand"><h3>&nbsp;&nbsp;&nbsp;Meatra<small>&nbsp;&nbsp;<a id="opensabout" href="#">About/Settings</a></small></h3></b>


		  <form class="navbar-form" role="search">
		  <div class="input-group">
			<input type="text" class="form-control" placeholder="Search" name="keywords" id="search-input" />
			<div class="input-group-btn">
			  <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" style="color:black;"></span></button>
			</div>
		  </div>
		</form>			
		<form class="navbar-form" method="POST" action="/watch">
		  <div class="input-group">
			<input type="text" class="form-control" placeholder="Torrent URL" name="torrent" id="search-input" />
			<div class="input-group-btn">
			  <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-plus-sign" style="color:black;"></span></button>
			</div>
		  </div>
		</form>
			
		</ul>
	</div>
</div>
<!-- END FIXED NAVBAR -->


<div class="data-om"> 
	<div class="data">
	<div class="normaldata">
	</div>
	<div class="otherdata">
	</div>
	</div>



	<div class="csspinner duo movieloader" style="display:none;">
	</div>


	<div class="overlay-panel sabout col-xs-12">
		<h2>About</h2>
		<p>This is an media streaming app made by <a href='https://github.com/gekkeabt' target='_blank'>Gekkeabt</a>.<br>
		This app is made with:<br>
		<ul>
		<li>Torrent-Stream ( Search on GitHub )</li>
		<li>NodeJS</li>
		<li>Node-WebKit</li>
		</ul>
		</p>
		<h2>Settings</h2>
		<p>Change these settings to your needs
		<form method="GET">
		<b>Sort movies by</b><br>
		<select name="sort">
		  <option value="">Choose sorting</option>
		  <option value="date">Date uploaded</option>
		  <option value="year">Year of Movie</option>
		  <option value="seeds">Seeds</option>
		  <option value="peers">Peers</option>
		  <option value="size">Size</option>
		  <option value="alphabet">Alphabet</option>
		  <option value="rating">Rating</option>
		  <option value="downloaded">Downloaded</option>
		</select>
		<br><br><b>In what order?</b><br>
		<select name="order">
		  <option value="">Choose order</option>
		  <option value="asc">From small to big</option>
		  <option value="desc">From big to small</option>
		</select>
		<br><br><b>Quality of the shown movies</b><br>
		<select name="quality">
		  <option value="">Choose Quality</option>
		  <option value="720p">720p</option>
		  <option value="1080p">1080p</option>
		</select><br><br>
		<button class="btn btn-primary">Save settings</button>
		</form>
		</p>
	</div>
</div>





</body>
</html>

<script src="js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="js/jquery.slimscroll.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script>
// Get the settings out of the URL
var queryString = "";
if (window.location.search.length > 1)
    queryString = window.location.search.substring (1);
var elements = queryString.split ("&");
var keyValues = {};
for(var i in elements) { 
    var key = elements[i].split("=");
    if (key.length > 1) {
      keyValues[decodeURIComponent(key[0].replace(/\+/g, " "))] = decodeURIComponent(key[1].replace(/\+/g, " "));
    }
}
if(keyValues["keywords"]!=null){
	var keywords=keyValues["keywords"];
}else{
	var keywords="";
}
if(keyValues["type"]!=null){
	var type=keyValues["type"];
}else{
	var type="";
}
if(keyValues["quality"]!=null){
	var quality=keyValues["quality"];
}else{
	var quality="720p";
}
if(keyValues["order"]!=null){
	var order=keyValues["order"];
}else{
	var order="desc";
}
if(keyValues["genre"]!=null){
	var genre = keyValues["genre"];
}else{
	var genre="";
}
if(keyValues["sort"]!=null){
	var sort = keyValues["sort"];
}else{
	var sort="year";
}
var api = "http://yts.re/api/list.json?limit=50&sort="+sort+"&keywords="+keywords+"&order="+order+"&quality="+quality+"&genre="+genre+"";




// Get list of movies available as torrent
$.getJSON(api, function(data) {
	var x = data.MovieList.length;
	var i = 0;
	$(".movieloader").hide(2000);
	$(".overlay-panel-loader").hide(2000);
    while(i < x){
		var st = data.MovieList[i];
		$(
			'<div class="movie">\
				<form method="post" action="watch" name="movieform'+st.ImdbCode+'">\
					<a href="javascript:document.movieform'+st.ImdbCode+'.submit();" class="md-trigger" data-modal="modal-'+st.ImdbCode+'">\
						<div class="picholder">\
							<img class="fancypics" id="image'+st.ImdbCode+'" alt="Movie Cover" width="120px"/>\
							<div class="overlay">\
								<p class="text_box"><h2><span class="glyphicon glyphicon-play-circle"></span></h2><br><span id="time'+st.ImdbCode+'"></p>\
							</div>\
						</div>\
					</a><br />\
					<span>'+st.MovieTitleClean+'</span><br>\
					<small>'+st.MovieYear+' - '+st.MovieRating+' - '+st.Genre+'</small>\
					<input type="hidden" name="torrent" placeholder="Enter magnet URL" value="'+st.TorrentMagnetUrl+'" /><br />\
				</form><br /><br />\
			</div>\
			').appendTo(".normaldata");
		var omdb='http://www.omdbapi.com/?i='+st.ImdbCode;
		$.getJSON(omdb, function(data2) {
			var poster = data2.Poster;
			var plot = data2.Plot;
			$("#image"+data2.imdbID).attr("src", poster);
			$("#image"+data2.imdbID).attr("title", plot);
		});
		i++;
	}
});

if(keyValues["keywords"]!=null){
	var keywords=keyValues["keywords"];	
	var api = "http://apify.ifc0nfig.com/tpb/search?id="+keywords+"&key=8d463e4278ea4c13968f720ca1503d28";
	$.getJSON(api, function(data) {
		console.log(data); // use data as a generic object 
		var x = data.length;
		var i = 0;
		var poster;
		if(x!=0){
			$('\
			<div class="col-xs-12"><br>\
				<h2>Other results <small>( possibly they are not all movies and will not work )</h2>\
				<h6><i>Check the size of the torrent, for normal connections torrents bigger than 1 GB probably will not work</i></h6>\
				<hr>\
			</div>\
			').appendTo(".otherdata");
			while(i < x){
				var st = data[i];
				$(
					'<div class="col-xs-6 col-sm-3 col-md-2 col-lg-1 columns movienopic">\
						<form method="post" action="/watch" name="movieform'+st.id+'">\
							<b style="color:#009CFF;">'+st.category+'</b><b> <small class="size">'+st.size+'</b></small><br>\
							<a href="javascript:document.movieform'+st.id+'.submit();"><span>'+st.name+'</span><br></a>\
							<input type="hidden" name="torrent" placeholder="Enter magnet URL" value="'+st.magnet+'" /><br />\
						</form><br /><br />\
					</div>'
				).appendTo(".otherdata");
				i++;
			}
		}
		$(".movieloader").hide(2000);
		$(".overlay-panel-loader").hide(2000);
	});	
}







if(keyValues["type"]!=null){
	var type=keyValues["type"];
	var api = "http://api.trakt.tv/shows/trending.json/87b75a5f952a096f022a00573c70b601";
	$.getJSON(api, function(data) {
		console.log(data); // use data as a generic object 
		var x = data.length;
		var i = 0;
		$(".movieloader").hide(2000);
		$(".overlay-panel-loader").hide(2000);
		while(i < x){
			var st = data[i];
			$(
				'<div class="movie">\
					<form method="post" action="/watch" name="movieform'+st.ImdbCode+'">\
						<a href="javascript:document.movieform'+st.ImdbCode+'.submit();" class="md-trigger" data-modal="modal-'+st.ImdbCode+'">\
							<img id="image'+st.ImdbCode+'" src="'+st.poster+'" alt="Movie Cover" width="120px"/>\
						</a><br />\
						<span>'+st.MovieTitle+'</span><br>\
						<small>'+st.MovieRating+' - '+st.Genre+'</small>\
						<input type="hidden" name="torrent" placeholder="Enter magnet URL" value="'+st.TorrentMagnetUrl+'" /><br />\
					</form><br /><br />\
				</div>\
				').appendTo(".normaldata");
			i++;
		}
	});
}
		


		
		
		
		
		
// List Genres
var genres = ['all','action','adventure','animation','biography','comedy','crime','documentary','drama','family','fantasy','film-noir','history','horror','music','musical','mystery','romance','sci-fi','sport','thriller','war','western'];
var x = genres.length;
var i = 0;
while(i<x){
	var link = genres[i];
	var value = link.charAt(0).toUpperCase() + link.slice(1)
	$('<li data-scroll-reveal="enter top"><a href="?genre='+link+'">'+value+'</a></li>').appendTo('.genres-menu');
	i++;
}





//Animations for scrolling and scrollbar designs
$(function(){
    $('.genres-menu').slimScroll({
        height: '100%',
    color: '#FAFAFA'
    });
});

$("#opensabout").click(function(){
	$(".sabout").slideToggle(500);
});
$(".movieloader").fadeIn(500);
$(".overlay-panel-loader").fadeIn(500);



</script>